from core.app import FunctionCallingAgent
from core.google_maps_api import find_places_within_travel_distance
from core.help_functions.ranking import rank_places
from core.vector_search.vector_db import Vector_DB
    
if __name__ == '__main__':
    # "Can you recommend a good coffee shop near downtown Boston that‚Äôs within a 10-minute walk?",
    #     "I‚Äôm looking for a highly-rated Thai restaurant in San Francisco‚Äîany suggestions?",
    user_querys = [
        "What‚Äôs the good bakery within walking distance from my hotel in Paris?",
        "Are there any nice parks in Toronto that are less than 15 minutes away on foot?",
        "Find me a rooftop bar in New York City with at least 4 stars on Google Maps.",
        "Any suggestions for a quiet place to read near Central Park?",
        "I want to find a pet-friendly caf√© close to my location‚Äîwhat do you recommend?",
        "Could you help me find a cozy bookstore within a 20-minute walk from here?",
        "What are some top-rated Italian restaurants near me with outdoor seating?",
        "Are there any museums nearby that are highly rated and open today?",
        "Suggest a good spot for brunch in Seattle that‚Äôs not too far to walk to.",
        "I'm in Chicago‚Äîwhere should I go for dessert that has at least 4.5 stars?",
        "I‚Äôm near Union Square. Know of any vegan restaurants with good reviews?",
        "Where can I find a dog park that‚Äôs close and well-rated?",
        "Looking for a bar with live music within a 10-minute walk‚Äîany ideas?",
        "Can you suggest a family-friendly attraction near my Airbnb?",
        "I need a quiet caf√© to work from in Berlin, preferably within 15 minutes walking distance.",
        "What‚Äôs a good place for a quick lunch around this area with solid reviews?",
        "Find me a sushi place nearby with at least 4 stars and good lunch specials.",
        "Are there any scenic spots or viewpoints I can easily walk to from here?",
    ]

    agent = FunctionCallingAgent()
    vector_db = Vector_DB()
    collection_name = 'test_collection'
    
    for user_query in user_querys:
        print(user_query)
        # result = agent.query(user_query=user_query)
        result = {'status': 'success', 'validated': {'location': {'type': 'landmark', 'value': 'Toronto, Golden Horseshoe, Ontario Canada', 'coordinates': (43.6534817, -79.3839347)}, 'place_to_search': 'park', 'travel_duration': {'value': 900.0, 'unit': 'seconds', 'mode': 'walking'}, 'minimum_star_requirement': {'rating': 3.5, 'fuzzy_rating': 3.4}, 'additional_requests': ['nice']}}
        print(result)
        
        # places = find_places_within_travel_distance(location=result['validated']['location']['coordinates'],
        #                                    minimum_star_requirement=result['validated']['minimum_star_requirement']['rating'],
        #                                    place_type=result['validated']['place_to_search'],
        #                                    travel_mode=result['validated']['travel_duration']['mode'],
        #                                    max_travel_time=result['validated']['travel_duration']['value'])
        # print(places)
        places = [{'name': 'Trinity Square Labyrinth', 'address': '24 Trinity Square, Toronto, ON M5G 1B1, Canada', 'rating': 4.1, 'price_level': 'N/A', 'reviews': [{'author': 'Soraya Wilks', 'rating': 5, 'text': 'Cute little park to eat your lunch at or stroll around. Right by the mall too - plenty of benches and green space to lay a blanket and enjoy a meal or snacks :)', 'time': 'a year ago', 'timestamp': 1694221735}, {'author': 'Art Hill', 'rating': 4, 'text': 'Who knew there was a labyrinth right in the middle of downtown Toronto. While walking the area I noticed a sign directing you to the labyrinth and decided to go check it out. It is a large circle in Trinity Square with a path leading to the centre using paving stones of two tones. It was just an interesting way to spent a few quiet minutes tracing the route to the centre of the labyrinth. The square was also being used by a few homeless with tents set up but although I thought they probably question the logic of wandering a route through the Labyrinth, they just ignored us.', 'time': '2 years ago', 'timestamp': 1660231892}, {'author': 'Booyaka Stubbs (ExplorewithStubbs.com)', 'rating': 3, 'text': 'Not much to look at but there is shade and a grassy area to sit and eat lunch. The labyrinth wasn\'t all too impressive i.m.h.o, just flat concrete and map of the area to walk. Tried to get a better vantage point with the drone but got the dreaded "too close to an airport" warning. Nice place to relax for a bit but not much else. Some areas near the church have a few aggressive homeless people there so just be on your toes...', 'time': '3 years ago', 'timestamp': 1631851836}, {'author': 'Anita Windisman', 'rating': 5, 'text': 'The Toronto Public Labyrinth (formerly the Trinity Square Park Labyrinth) is Toronto\'s first outdoor labyrinth in a public park. Designed by Stuart and Mary Bartholomaus from Knoxville, Tennessee. The labyrinth was created out of turf grass, temporarily, but is now constructed out of paving stone. The labyrinth is 77 feet in diameter. It is a copy of the 13th century stone labyrinth at Chartres Cathedral in France.\n\nInstallation of the\xa0Toronto\xa0Public Labyrinth\nThe Labyrinth was installed as a Millennium project in partnership between Parks, Forestry and Recreation and the Toronto Labyrinth Community Network (TLCN). TLCN is a grassroots community organization which fosters the creation of labyrinths as meditation tools in the Greater Toronto Area. In partnership with Toronto Parks and Recreation and the nearby Church of the Holy Trinity, the group guided the creation of the Trinity Square Park Labyrinth as a Millennium Year project.\n\nTLCN, in continued collaboration with Parks and Recreation, will also guide the development of the "Lasting Labyrinth", a permanent labyrinth feature of stone and grass, to be installed at Trinity Square Park.', 'time': '4 years ago', 'timestamp': 1598147096}, {'author': 'Paul Comeau', 'rating': 4, 'text': "Very pleasant, spacious, cool oasis in the middle of downtown hustle and bustle. Centred between the Eaton Centre, Old City Hall, and containing one of the city's oldest churches, this is a perfect escape.", 'time': '5 years ago', 'timestamp': 1559159051}], 'phone': '(416) 338-4386', 'website': 'http://www.labyrinthnetwork.ca/toronto-public-labyrinth/', 'opening_hours': ['Monday: Open 24 hours', 'Tuesday: Open 24 hours', 'Wednesday: Open 24 hours', 'Thursday: Open 24 hours', 'Friday: Open 24 hours', 'Saturday: Open 24 hours', 'Sunday: Open 24 hours'], 'location': (43.6541746, -79.3818735), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 12.0, 'travel_mode': 'walking'}, {'name': 'Cloud Gardens', 'address': '14 Temperance St, Toronto, ON M5H 0B4, Canada', 'rating': 3.9, 'price_level': 'N/A', 'reviews': [{'author': 'Christian Habisreutinger', 'rating': 1, 'text': 'Sadly the garden is (still) closed for construction (?)\nUsed to be an oasis for relaxation within the city‚Äôs hustle and bustle.\n\nCity of Toronto, please restore the beautiful cloud gardens.', 'time': '9 months ago', 'timestamp': 1722624007}, {'author': 'Anita Windisman', 'rating': 5, 'text': "Update on July 2023: The Garden is not quite finished, and is still a work in progress. But a part of it is now open and you can sit down on benches. Looking forward to it being totally complete.\n\nUpdate on December 2018: Due to construction at an adjacent site, the park is now closed. Expected to open in the fall of 2022. See image of construction notice uploaded.\n\nA green oasis right in the middle of the financial district.  It has nooks and crannies throughout, so be careful when you visit. I found drug needles and discarded clothing and garbage on the upper levels. The park isn't well maintained, which is such a shame. I didn't feel comfortable visiting this park - not even on an early Sunday morning - because of people loitering there.", 'time': 'a year ago', 'timestamp': 1690729512}, {'author': 'Cody Eason', 'rating': 3, 'text': 'If they had someone clean up the garbage more often this park a great 5-star spot. Great looking park no play ground but fun for adults.', 'time': '6 years ago', 'timestamp': 1539526446}, {'author': 'Jennifer Tang', 'rating': 5, 'text': 'Actually really liked this spot! It‚Äôs in the heart of downtown, so it‚Äôs a nice dose of greenery.\nNothing too notable in terms of plants, but it‚Äôs a quiet and small place to unwind and relax.', 'time': '7 years ago', 'timestamp': 1525795752}, {'author': 'Yoshuna', 'rating': 5, 'text': 'Great place for a little break from the city. Small greenhouse, but very calming. Interesting array of plants. Worth the trip here if you‚Äôre in the area!', 'time': '7 years ago', 'timestamp': 1525363234}], 'phone': '(416) 392-7288', 'website': 'https://www.toronto.ca/explore-enjoy/parks-gardens-beaches/gardens-and-horticulture/conservatories/cloud-gardens-conservatory/', 'opening_hours': ['Monday: Open 24 hours', 'Tuesday: Open 24 hours', 'Wednesday: Open 24 hours', 'Thursday: Open 24 hours', 'Friday: Open 24 hours', 'Saturday: Open 24 hours', 'Sunday: Open 24 hours'], 'location': (43.6511469, -79.38009660000002), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 9.0, 'travel_mode': 'walking'}, {'name': 'Fountain at Nathan Phillips Square', 'address': 'The PATH - City Hall, Toronto, ON M5H 2N3, Canada', 'rating': 4.6, 'price_level': 'N/A', 'reviews': [{'author': 'Cristiane Bettini', 'rating': 5, 'text': 'It was a great experience for the whole family. Even if you have never tried ice skating it is nice and safe.\nThe only warn it is to be aware of the closure time, on December it was 21h30. The rental line was long and the rental it was $15 per two hours at that moment.', 'time': '4 months ago', 'timestamp': 1735605983}, {'author': 'Emely Tesoro', 'rating': 4, 'text': 'There is a food festival when we go there so its a little crowded. Managed to took the Toronto Sign picture which is our main purpose. Short but a must visit when you are in Toronto.', 'time': 'a year ago', 'timestamp': 1689010720}, {'author': 'Hithasha Kurera', 'rating': 5, 'text': 'Had an Amazing experience skating here last night. Lots of space to practice in and have some fun!! Would go there again! Iconic Toronto sign is really nice for pictures.', 'time': '2 years ago', 'timestamp': 1678374305}, {'author': 'The K Green Show', 'rating': 5, 'text': "Very nice area with the iconic Toronto sign overlooking it.  Arches and spouts for this 10in or so deep fountain.  Oh .. please don't climb the arches and don't fall in!  Lol", 'time': '2 years ago', 'timestamp': 1664710838}, {'author': 'Carol F', 'rating': 5, 'text': 'Iconic landscape and great must-visit tourist spot to get photos of Toronto. It\'s also a good meeting spot with friends and family. There\'s always something interesting and events hosted here at Nathan Phillips Square.\n\nLocated at Nathan Phillips Square (in front of City Hall), this versatile large water fountain remains as a fountain/pond during Spring, Summer and Fall. While in Winter, the fountain transforms into an outdoor Ice Rink for the public to enjoy. There are skates rentals on site but be prepared to line up and bring ID. This captivating setting is enjoyed all year long for people of all ages. Many seasonal activities and events are planned around this fountain and at Nathan Phillips Square so be sure to check the Festivals & Events Page on the City of Toronto\'s website.\n\nAlso to note, from the southwest corner of the fountain, you can take a photo of the iconic Toronto 3D Sign with the Toronto City Hall in the background. The fountain\'s arches are called "The Freedom Arches" that span over the pool/skating rink. At the base of the arches is a piece of the Berlin Wall. Conveniently accessible via Eaton Center along Bay Street (closest TTC Subway station would be Queen Station).', 'time': '3 years ago', 'timestamp': 1640806663}], 'phone': '(416) 338-0889', 'website': 'http://toronto.ca/', 'opening_hours': ['Monday: Open 24 hours', 'Tuesday: Open 24 hours', 'Wednesday: Open 24 hours', 'Thursday: Open 24 hours', 'Friday: Open 24 hours', 'Saturday: Open 24 hours', 'Sunday: Open 24 hours'], 'location': (43.6522507, -79.38332779999999), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 1.8, 'travel_mode': 'walking'}, {'name': 'Larry Sefton Park', 'address': '500 Bay St., Toronto, ON M5G 0B3, Canada', 'rating': 4.2, 'price_level': 'N/A', 'reviews': [{'author': 'Nicholas Gouvis', 'rating': 5, 'text': "I've lived and absolutely loved living in Toronto especially in the 60s & 70s. Every park in the area at the time was the Oasis in the growing concrete jungle. Larry Sefton Park was the twinkle that made the trip to City Hall just sparkling with life. From the early days of the CUPE/LOCAL union rallies that went more like family picnics, bbq hotdogs with only mustard, games and sun filled summers of pure fun.  lol lol, I still have my LOCAL 79 T-Shirt of support. Then the slow fun filled walk to Parliament Hill as the evening picnics cont'd and Bbqs flared again within the background of fun and laughter of children playing. It's just not the same anymore.\nToday There's Just Too much anger in the shadows of what we stood for back then.. All lost with all the massive construction madness , together with economic crisis forever changing what WE THE IMMIGRANT WORKERS came for and fought to preserve here in the Canada of the 50s & 60s.\n\nThe bond that were ALL in this together,  and together we all make this a safe city to work and live in.\nToo bad this way of life we lived those days now forever lost only alive in memory..", 'time': '2 years ago', 'timestamp': 1682956379}, {'author': 'Una Rose', 'rating': 5, 'text': 'Small little parkette. It has grass, a tree and lots of flowers. Lots of butterflies! Nice place to meet and take a break.', 'time': '2 years ago', 'timestamp': 1658437039}, {'author': 'Kenneth Kimmes', 'rating': 5, 'text': 'This park is mobility accessible. It is at ground level and accessible on many sides. The park was created in honour of Larry Sefton who was a leader in the United Steelworkers Union. There is a metal structure as a piece of art next to the plaque describing all about Larry Sefton and the park. There is several benches to relax or have a nice lunch on. This is also neighbouring Nathan Philips Square and city hall. It is also very close to several hotels in the area and Eaton Centre.', 'time': '3 years ago', 'timestamp': 1651447790}, {'author': 'Anita Windisman', 'rating': 5, 'text': 'A lovely oasis on Bay Street, tucked in right behind city hall. Has places to sit, and a water fountain where you can refill your water bottle.', 'time': '5 years ago', 'timestamp': 1564240473}, {'author': 'Rabin Ramah', 'rating': 5, 'text': "Quiet little Parkette minus the traffic on Bay Street. They've cleaned it up by destroying alot of the smaller trees around the area  but you can still sit and have a quiet moment. #TORONTO is the only city I know with Parkettes. Across from the Marriott Hotel & the Eaton Centre. Beautiful Country Red Brick Wall makes a great back drop for a Still Life.", 'time': '6 years ago', 'timestamp': 1549788136}], 'phone': 'N/A', 'website': 'https://www.toronto.ca/data/parks/prd/facilities/complex/377/index.html', 'opening_hours': ['Monday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Tuesday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Wednesday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Thursday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Friday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Saturday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Sunday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM'], 'location': (43.654397, -79.383534), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 11.5, 'travel_mode': 'walking'}, {'name': 'Downtown Diversity Garden', 'address': '89 Elizabeth St, Toronto, ON M5G 1P4, Canada', 'rating': 3.9, 'price_level': 'N/A', 'reviews': [{'author': 'N Davis', 'rating': 2, 'text': 'This park has  been a great little green space, but the maintenance is slipping.  The seating and picnic tables need replacing. the plantings and wood chips need replacing, and the overall presentation  is looking  very worn down.   It also needs more regular garbage pickup.  I hope the people in charge will do something soon, or it will just become another typical Toronto project - do something interesting, then walk away and neglect it. Sorry to be so negative, but this place needs some TLC.', 'time': 'a year ago', 'timestamp': 1687272567}, {'author': 'Lorenzo Noah', 'rating': 5, 'text': 'A wonderful place to sit and get some quiet in the city. I found this place one day while exploring and has become my go to spot to eat in the city during the pandemic. The spaced out picnic tables and the quiet makes it perfect to eat safely. Would recommend grabbing food nearby and eating it at the park !', 'time': '3 years ago', 'timestamp': 1625032592}, {'author': 'K K', 'rating': 4, 'text': 'This is a nice small space for taking a break if you work nearby. The garden is well maintained. There isn‚Äôt any grass and has wood chips instead. There should be an ashtray installed as there are cigarette butts everywhere.', 'time': '6 years ago', 'timestamp': 1533232678}, {'author': 'Grimoaldo Assuncao', 'rating': 5, 'text': 'A ‚Äúpiece of Nature‚Äù in Downtown.\n\nWell, this is a secret place in downtown between the highlight buildings of the city Center.\n\nIs a place where you can go, take a sit and relax, looking for one small and beautiful place for a little talk, or breath or even for a fast snack.\n\nAlways there are some employees taking care of this place and not allowing people do wrong things or bad using of this place.\n\nI really recommend you visit this small, but beautiful secret place in downtown area of Toronto.', 'time': '6 years ago', 'timestamp': 1529614153}, {'author': 'Jimmy Lu', 'rating': 4, 'text': 'A bit of a tucked away oasis off the bustling Bay and Dundas intersection. It is often busy during warm seasons at lunch time with public employees. There are a few benches, tables, and a mulchy terrain.', 'time': '8 years ago', 'timestamp': 1485887996}], 'phone': 'N/A', 'website': 'http://www.toronto.ca/', 'opening_hours': ['Monday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Tuesday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Wednesday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Thursday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Friday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Saturday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM', 'Sunday: 5:30\u202fAM\u2009‚Äì\u200912:00\u202fAM'], 'location': (43.65448019999999, -79.38456), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 14.2, 'travel_mode': 'walking'}, {'name': 'The Path', 'address': '31 Adelaide St E, Toronto, ON M5C 1J4, Canada', 'rating': 4.1, 'price_level': 'N/A', 'reviews': [{'author': 'Anthony Sacco', 'rating': 5, 'text': 'We started at the skywalk and explored for several hours under ground. We got lost, but were happy to do so, and ate an amazing lunch. Our 3 boys loved exploring down there and the challenge of navigating it all. I will say that even preparing ahead of time with a picture of the map on my phone and memorizing some streets around the area, there were still times we got lost because the signs would just stop. For instance, finding your way to the waterfront seemed impossible so we finally just went up and walked the rest of the way. Tip: make sure to look for the path signs and arrow even in unlikely spots. In a grocery store near starbucks for instance. We had all the time in the world so getting lost was part of the fun. It was near 90 and muggy out so being down there was nice. Safe too! Busy at lunchtime but people seem friendly if you need help.', 'time': '9 months ago', 'timestamp': 1722437606}, {'author': 'Sasha kor', 'rating': 5, 'text': 'Hard to find', 'time': 'a year ago', 'timestamp': 1704325831}, {'author': 'Karen Lizeth', 'rating': 5, 'text': "The path is an subterranean path with store and coffee shops that goes underneath Toronto, it is really helpful when it's raining or snowing like crazy. You can get access from many hotels, building and stores. It's worth taking a look at it. not many places have such infrastructure as this. You can get into union station from here which takes you mostly anywhere around Toronto", 'time': 'a year ago', 'timestamp': 1699219382}, {'author': 'Sharad Gondaliya', 'rating': 5, 'text': 'Great place for roaming, lunch n shopping in the working day', 'time': 'a year ago', 'timestamp': 1689105283}, {'author': 'I G', 'rating': 5, 'text': 'We took the PATH from Brookfield place to Dundas (where we took the subway to Bloor/Yonge) on our way to Eataly. It was a great walk and a perfect way to travel avoiding the heavy rain today. We checked the PATH map ( well placed) often to make sure we were heading the right way. It‚Äôs safe,  clean and efficient. It‚Äôs too bad none of the businesses aren‚Äôt open on weekends. I highly recommend using the PATH. PS. You can download the PATH map to plan your route.', 'time': '2 years ago', 'timestamp': 1682217426}], 'phone': 'N/A', 'website': 'N/A', 'opening_hours': ['Monday: Open 24 hours', 'Tuesday: Open 24 hours', 'Wednesday: Open 24 hours', 'Thursday: Open 24 hours', 'Friday: Open 24 hours', 'Saturday: Open 24 hours', 'Sunday: Open 24 hours'], 'location': (43.6504858, -79.37693229999999), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 13.8, 'travel_mode': 'walking'}, {'name': 'Oscar Peterson Place', 'address': '66 Wellington St W, Toronto, ON M5J 2W4, Canada', 'rating': 5, 'price_level': 'N/A', 'reviews': [{'author': 'Cyril Delabarre', 'rating': 5, 'text': 'Beautiful', 'time': 'a year ago', 'timestamp': 1691545129}, {'author': 'Waldo Marxx', 'rating': 5, 'text': 'Rainy morning', 'time': '3 years ago', 'timestamp': 1634730707}, {'author': 'Anita Windisman', 'rating': 5, 'text': 'A lovely, but low key tribute to Canadian jazz pianist Oscar Peterson. üéπüé∂', 'time': '4 years ago', 'timestamp': 1592782921}, {'author': 'Leonardo M', 'rating': 5, 'text': '', 'time': '5 years ago', 'timestamp': 1572023647}, {'author': 'Caitlin Stassa', 'rating': 5, 'text': '', 'time': '5 years ago', 'timestamp': 1561259658}], 'phone': '(416) 862-7747', 'website': 'http://www.tdcentre.com/en/About/Pages/Area-Amenities.aspx', 'opening_hours': ['Monday: Open 24 hours', 'Tuesday: Open 24 hours', 'Wednesday: Open 24 hours', 'Thursday: Open 24 hours', 'Friday: Open 24 hours', 'Saturday: Open 24 hours', 'Sunday: Open 24 hours'], 'location': (43.6471044, -79.38199279999999), 'review_note': 'Note: Google Places API returns up to 5 reviews per place (latest selected).', 'travel_time': 11.3, 'travel_mode': 'walking'}]
        
        if places:
            # for place in places:
            #     print(place)
            # input(123)
            ranked_places = rank_places(places, keywords=result['validated']['additional_requests'])
            for i, ranked_place in enumerate(ranked_places):
                print(f'rank {i+1}')
                vector_db.add_vectors(collection_name=collection_name, place_data=ranked_place)
                input('pause')
        else:
            print('No recommend places')
        input('next')